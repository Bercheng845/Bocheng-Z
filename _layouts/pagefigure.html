---
layout: pagegallery
---

<head>
    <link href="/assets/js/lightbox.css" rel="stylesheet" />
    <style>
        /* 图片网格样式 */
        .figure-grid {
            margin: 0 auto;
        }

        .figure-grid-sizer,
        .figure-grid-item {
            width: 33.333%;
            /* 恢复为3列布局 */
        }

        .figure-grid img,
        .figure-grid a img {
            width: 100%;
            height: auto;
            display: block;
            break-inside: avoid;
        }

        .figure-grid-item img {
            padding: 5px 5px;
        }

        .figure-grid a {
            text-decoration: none;
            border: none;
            outline: none;
        }

        .figure-grid a::after {
            content: none !important;
        }

        .figure-grid-item {
            background-color: rgba(79, 177, 186, 0.5);
            transition: background-color 0.3s ease-in-out;
        }

        .figure-grid-item.loaded {
            background-color: transparent;
        }

        .figure-grid-item img.lozad:not([src]) {
            min-height: 300px;
            visibility: hidden;
        }

        .figure-grid-item img.loaded {
            visibility: visible;
        }

        .image-link img {
            transition: transform 0.3s ease-in-out;
        }

        .image-link img:hover {
            transform: scale(1.05);
        }

        @media screen and (max-width: 768px) {

            .figure-grid-sizer,
            .figure-grid-item {
                width: 50%;
                /* 中等屏幕上是2列 */
            }
        }

        @media screen and (max-width: 480px) {

            .figure-grid-sizer,
            .figure-grid-item {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- 内容区域 -->
    <div id="content-container">
        <div id="image-section" class="content-section active">
            {{ content }}
        </div>
    </div>

    <!-- 图片脚本 -->
    <script src="/assets/js/lozad.js"></script>
    <script src="/assets/js/masonry.pkgd.min.js"></script>
    <script src="/assets/js/imagesloaded.pkgd.min.js"></script>
    <script>
        // 全局错误处理
        window.onerror = function (msg, url, line, col, error) {
            console.log("全局错误:", msg, "在", url, "行", line);
            return false;
        };

        // 添加调试信息输出
        console.log("开始加载页面...");
        console.log("当前页面URL:", window.location.href);

        // 检查资源是否正确加载
        function checkResourcesLoaded() {
            console.log("检查资源加载状态:");
            console.log("- Masonry 加载状态:", typeof Masonry !== 'undefined' ? "已加载" : "未加载");
            console.log("- imagesLoaded 加载状态:", typeof imagesLoaded !== 'undefined' ? "已加载" : "未加载");
            console.log("- lozad 加载状态:", typeof lozad !== 'undefined' ? "已加载" : "未加载");
            console.log("- lightbox 加载状态:", typeof lightbox !== 'undefined' ? "已加载" : "未加载");

            var imageGrid = document.querySelector('.figure-grid');
            console.log("- 图片网格元素:", imageGrid ? "存在" : "不存在");
            if (imageGrid) {
                console.log("  图片网格内容:", imageGrid.innerHTML.trim() ? "有内容" : "无内容");
            }
        }

        // 尝试手动加载关键资源
        function loadMissingResources() {
            console.log("尝试手动加载缺失资源...");

            if (typeof Masonry === 'undefined') {
                var masonryScript = document.createElement('script');
                masonryScript.src = '/assets/js/masonry.pkgd.min.js';
                masonryScript.onload = function () { console.log("Masonry 已手动加载"); delayedInit(); };
                document.head.appendChild(masonryScript);
            }

            if (typeof imagesLoaded === 'undefined') {
                var imagesLoadedScript = document.createElement('script');
                imagesLoadedScript.src = '/assets/js/imagesloaded.pkgd.min.js';
                imagesLoadedScript.onload = function () { console.log("imagesLoaded 已手动加载"); delayedInit(); };
                document.head.appendChild(imagesLoadedScript);
            }

            if (typeof lozad === 'undefined') {
                var lozadScript = document.createElement('script');
                lozadScript.src = '/assets/js/lozad.js';
                lozadScript.onload = function () { console.log("lozad 已手动加载"); delayedInit(); };
                document.head.appendChild(lozadScript);
            }

            if (typeof lightbox === 'undefined') {
                var lightboxScript = document.createElement('script');
                lightboxScript.src = '/assets/js/lightbox-plus-jquery.js';
                lightboxScript.onload = function () { console.log("lightbox 已手动加载"); delayedInit(); };
                document.head.appendChild(lightboxScript);
            }
        }

        // 添加安全执行函数，防止错误中断
        function safeExecute(fn, fallback) {
            try {
                return fn();
            } catch (e) {
                console.log("函数执行错误:", e);
                if (typeof fallback === 'function') {
                    return fallback();
                }
                return null;
            }
        }

        // 尝试清除可能的缓存问题
        function clearCacheProblem() {
            console.log("尝试清除缓存问题...");

            // 强制重新获取可能被缓存的资源
            var scripts = document.querySelectorAll('script[src]');
            scripts.forEach(function (script) {
                if (!script.src.includes('?')) {
                    console.log("重新加载资源:", script.src);
                    var newScript = document.createElement('script');
                    newScript.src = script.src + '?ver=' + new Date().getTime();
                    newScript.onload = function () {
                        console.log("资源重新加载成功:", script.src);
                        // 资源重新加载后，再次尝试初始化
                        delayedInit();
                    };
                    script.parentNode.replaceChild(newScript, script);
                }
            });
        }

        // 检查资源加载
        checkResourcesLoaded();

        // 启动延迟初始化
        loadMissingResources();
        delayedInit();

        // 页面加载后再次检查
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM完全加载");
            safeExecute(function () {
                checkResourcesLoaded();
                // 再次尝试加载资源和初始化
                loadMissingResources();
                delayedInit();
            });
        });

        // 如果4秒后图片或按钮仍未正确加载，尝试清除缓存问题
        setTimeout(function () {
            console.log("执行4秒检查...");
            if (!document.querySelector('.figure-grid-item.loaded')) {
                console.log("检测到可能的资源加载问题，尝试修复...");
                clearCacheProblem();
                loadMissingResources();
            }
        }, 4000);
    </script>

    <script>
        // 加载lightbox脚本
        document.addEventListener('DOMContentLoaded', function () {
            var lightboxScript = document.createElement('script');
            lightboxScript.src = '/assets/js/lightbox-plus-jquery.js?v=' + new Date().getTime();
            document.body.appendChild(lightboxScript);

            lightboxScript.onload = function () {
                console.log("Lightbox脚本加载成功");
                if (typeof lightbox !== 'undefined') {
                    lightbox.option({
                        'resizeDuration': 200,
                        'wrapAround': true,
                        'fitImagesInViewport': true,
                        'disableScrolling': true
                    });
                }
            };
        });
    </script>

    <script>
        // 延迟初始化函数，确保资源正确加载
        function delayedInit() {
            safeExecute(function () {
                console.log("尝试执行delayedInit...");
                checkResourcesLoaded();

                // 如果必要的库没有加载成功，则等待并重试
                if (typeof Masonry === 'undefined' || typeof imagesLoaded === 'undefined' || typeof lozad === 'undefined') {
                    console.log("关键库未加载，将在500ms后重试...");
                    setTimeout(delayedInit, 500); // 500毫秒后重试
                    return;
                }

                console.log("所有库已加载，开始初始化...");

                // 直接初始化图片
                initMasonry();
            });
        }

        // 只有当图片部分是可见的时才初始化masonry
        function initMasonry() {
            if (!document.querySelector('.figure-grid')) return;

            var grid = document.querySelector('.figure-grid');
            var msnry = new Masonry(grid, {
                itemSelector: '.figure-grid-item',
                columnWidth: '.figure-grid-sizer',
                percentPosition: true
            });

            if (window.lozadObserver && window.lozadObserver.observer) {
                window.lozadObserver.observer.disconnect();
            }

            window.lozadObserver = lozad('.lozad', {
                rootMargin: '50px 0px',
                threshold: 0.1,
                loaded: function (el) {
                    el.classList.add('loaded');
                    var item = el.closest('.figure-grid-item');
                    if (item) item.classList.add('loaded');
                    imagesLoaded(el, function () {
                        msnry.layout();
                    });
                }
            });

            window.lozadObserver.observe();

            imagesLoaded(grid).on('progress', function (instance, image) {
                msnry.layout();
            }).on('always', function () {
                setTimeout(function () {
                    msnry.layout();
                }, 100);
            });
        }

        // 在页面加载完成前先直接初始化图片
        var initImagesDirectly = function () {
            safeExecute(function () {
                // 直接初始化图片
                initMasonry();
                // 初始化lightbox
                if (typeof lightbox !== 'undefined') {
                    lightbox.option({
                        'resizeDuration': 200,
                        'wrapAround': true,
                        'fitImagesInViewport': true,
                        'disableScrolling': true
                    });
                }
            });
        };
    </script>
</body>